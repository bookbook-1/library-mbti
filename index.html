<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ ì±… ì¶”ì²œ í…ŒìŠ¤íŠ¸ (O/X)</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        /* ì•„ì´ë“¤ì—ê²Œ ì¹œìˆ™í•œ í°íŠ¸ì™€ ë””ìì¸ */
        body { font-family: 'Jua', sans-serif; background-color: #FFF9C4; text-align: center; margin: 0; padding: 20px; color: #444; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        /* í™”ë©´ ì „í™˜ ì œì–´ */
        #loading, #quiz-box, #result-box { display: none; }
        .active { display: block !important; }

        /* O/X ë²„íŠ¼ ë””ìì¸ */
        .ox-container { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }
        .btn-ox { 
            width: 120px; height: 120px; 
            border-radius: 50%; border: none; 
            font-size: 60px; font-family: 'Jua', sans-serif;
            cursor: pointer; transition: transform 0.2s; 
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
        }
        .btn-o { background-color: #4CAF50; color: white; } /* ì´ˆë¡ìƒ‰ O */
        .btn-x { background-color: #F44336; color: white; } /* ë¹¨ê°„ìƒ‰ X */
        .btn-ox:active { transform: translateY(5px); box-shadow: none; }
        .btn-ox:hover { transform: scale(1.05); }

        .btn-start { background-color: #FF9800; color: white; font-size: 24px; padding: 15px 40px; border:none; border-radius: 50px; cursor: pointer; }
        
        /* ê²°ê³¼ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .result-img { width: 100%; max-width: 250px; border-radius: 20px; margin: 20px 0; border: 5px solid #FFD54F; }
        .book-card { background: #fdfdfd; padding: 15px; border-radius: 15px; border: 3px solid #eee; display: flex; align-items: center; gap: 15px; margin-bottom: 15px; text-align: left; }
        .book-card img { width: 80px; height: 110px; object-fit: cover; border-radius: 8px; background: #ddd; }
        .tag { background: #FFECB3; padding: 5px 10px; border-radius: 10px; font-size: 14px; color: #E65100; }
    </style>
</head>
<body>

    <div class="container">
        <div id="loading" class="active">
            <h2>ë¬¸ì œì§€ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆì–´ìš”...<br>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ìš”! ğŸš€</h2>
        </div>

        <div id="start-box">
            <h1 style="font-size: 40px; margin-bottom: 10px;">ğŸ“š ë…ì„œ ì„±í–¥ í…ŒìŠ¤íŠ¸</h1>
            <p style="font-size: 20px;">ë‚˜ëŠ” ì–´ë–¤ ì±…ì„ ì¢‹ì•„í• ê¹Œ?<br>12ë¬¸ì œë¡œ ì•Œì•„ë³´ì•„ìš”!</p>
            <br>
            <button class="btn-start" onclick="startQuiz()">ì‹œì‘í•˜ê¸° â–¶</button>
        </div>

        <div id="quiz-box">
            <h3 id="q-progress" style="color:#888;">1 / 12</h3>
            <h2 id="q-text" style="font-size: 32px; word-break: keep-all; min-height: 100px; display:flex; align-items:center; justify-content:center;">ì§ˆë¬¸ ë‚´ìš©</h2>
            
            <div class="ox-container">
                <button class="btn-ox btn-o" onclick="selectOption('A')">O</button>
                
                <button class="btn-ox btn-x" onclick="selectOption('B')">X</button>
            </div>
            <p style="margin-top:20px; color:#888;">ë§ìœ¼ë©´ O, ì•„ë‹ˆë©´ Xë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
        </div>

        <div id="result-box">
            <h2>ë‚˜ì˜ ë…ì„œ ì¹œêµ¬ëŠ”?</h2>
            <h1 id="result-title" style="color:#E65100; font-size:35px;">ê²°ê³¼ ì´ë¦„</h1>
            <img id="result-img" class="result-img" src="" alt="ê²°ê³¼ ì´ë¯¸ì§€">
            <p id="result-desc" style="font-size: 18px; line-height: 1.6;">ê²°ê³¼ ì„¤ëª…</p>
            
            <hr style="border: 2px dashed #ddd; margin: 30px 0;">
            
            <h3>ğŸ ë‚˜ì—ê²Œ ë”± ë§ëŠ” ì±… ì„ ë¬¼</h3>
            <div id="book-list"></div>
            
            <button class="btn-start" onclick="location.reload()" style="margin-top:30px; font-size:18px;">ë‹¤ì‹œ í•˜ê¸° â†º</button>
        </div>
    </div>

    <script>
        // ==========================================
        // ì—¬ê¸°ì— êµ¬ê¸€ ìŠ¤í”„ë ˆë“œ ì‹œíŠ¸ IDë¥¼ ë„£ì–´ì£¼ì„¸ìš”
        // ==========================================
        const SHEET_ID = 'ì—¬ê¸°ì—_ì‹œíŠ¸_IDë¥¼_ë³µì‚¬í•´ì„œ_ë„£ìœ¼ì„¸ìš”'; 

        let questions = [];
        let results = {};
        let currentQ = 0;
        let scores = { E:0, I:0, S:0, N:0, T:0, F:0, J:0, P:0 };

        async function loadData() {
            const base = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=`;
            try {
                const qRes = await fetch(base + 'Questions');
                questions = csvToJson(await qRes.text());

                const rRes = await fetch(base + 'Results');
                const rData = csvToJson(await rRes.text());
                rData.forEach(row => results[row.mbti] = row);

                document.getElementById('loading').classList.remove('active');
                document.getElementById('start-box').classList.add('active');
            } catch (err) {
                alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”. ì‹œíŠ¸ ì£¼ì†Œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”!");
            }
        }

        function csvToJson(csv) {
            const rows = csv.split('\n');
            const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));
            
            return rows.slice(1).map(row => {
                const values = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.trim().replace(/^"|"$/g, ''));
                let obj = {};
                headers.forEach((h, i) => obj[h] = values[i] || '');
                return obj;
            });
        }

        function startQuiz() {
            document.getElementById('start-box').classList.remove('active');
            document.getElementById('quiz-box').classList.add('active');
            showQuestion();
        }

        function showQuestion() {
            const q = questions[currentQ];
            document.getElementById('q-progress').innerText = `${currentQ + 1} / ${questions.length}`;
            document.getElementById('q-text').innerText = q.question;
            // O/X ë²„íŠ¼ì´ë¯€ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë°”ê¿€ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
        }

        function selectOption(choice) {
            const q = questions[currentQ];
            // Aë¥¼ ì„ íƒí•˜ë©´ O(ê·¸ë ‡ë‹¤) -> A_val ì ìˆ˜ íšë“
            // Bë¥¼ ì„ íƒí•˜ë©´ X(ì•„ë‹ˆë‹¤) -> B_val ì ìˆ˜ íšë“
            const val = choice === 'A' ? q.A_val : q.B_val;
            
            if(scores[val] !== undefined) scores[val]++;

            currentQ++;
            if (currentQ < questions.length) {
                showQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            const mbti = [
                scores.E >= scores.I ? 'E' : 'I',
                scores.S >= scores.N ? 'S' : 'N',
                scores.T >= scores.F ? 'T' : 'F',
                scores.J >= scores.P ? 'J' : 'P'
            ].join('');

            const data = results[mbti];
            
            document.getElementById('quiz-box').classList.remove('active');
            document.getElementById('result-box').classList.add('active');

            if(data) {
                document.getElementById('result-title').innerText = data.title;
                document.getElementById('result-desc').innerText = data.desc;
                document.getElementById('result-img').src = data.img_url || '';

                const bookList = document.getElementById('book-list');
                bookList.innerHTML = `
                    <div class="book-card">
                        <img src="${data.book1_img}">
                        <div><span class="tag">1-2í•™ë…„</span><h4 style="margin:5px 0;">${data.book1_title}</h4></div>
                    </div>
                    <div class="book-card">
                        <img src="${data.book2_img}">
                        <div><span class="tag">3-4í•™ë…„</span><h4 style="margin:5px 0;">${data.book2_title}</h4></div>
                    </div>
                    <div class="book-card">
                        <img src="${data.book3_img}">
                        <div><span class="tag">5-6í•™ë…„</span><h4 style="margin:5px 0;">${data.book3_title}</h4></div>
                    </div>
                `;
            } else {
                alert("ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”: " + mbti);
            }
        }

        loadData();
    </script>
</body>
</html>
